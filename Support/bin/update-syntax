#!/usr/bin/env php
<?php

require __DIR__.'/../vendor/autoload.php';

use TextMate\Plist;

$file = file_get_contents(__DIR__.'/../dev/php.tmLanguage.json');
if (!$file) {
	throw new \RuntimeException('php.tmLanguage.json not found');
}

/** @var array<array<mixed>> */
$data = json_decode($file);

$plist = new Plist((array) $data);

// This is not a safe way to change indentation.
echo preg_replace_callback(
	'/>\n(\s+)</',
	(fn (int $width, int $adjust = 0) => fn ($line) => sprintf(
		">\n%s<",
		str_repeat("\t", (strlen($line[1]) - ($width * -$adjust)) / $width),
	))(2, -1),
	$plist->toDom()->saveXml(),
);
